---
import { contentfulClient } from "~/lib/contentful";
import Layout from "~/layouts/Layout.astro";
import type { Post } from "~/lib/contentful";

const entries = await contentfulClient.getEntries<Post>({
    content_type: "post",
    order: ["fields.priority", "fields.date"],
});

const posts = entries.items.map((item) => {
    console.log("fields", item.fields);

    const {
        title,
        date,
        description,
        slug,
        thumbnail,
        gallery,
        priority,
        content,
    } = item.fields;
    return {
        thumbnail: {
            src: thumbnail.fields.file.url,
            alt: thumbnail.fields.description,
        },
        title,
        slug,
        description,
        date: new Date(date).toLocaleDateString(),
    };
});
---

<Layout title="Cikkek">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
            posts.map((post) => (
                <div class="bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-xl font-semibold mb-2">{post.title}</h2>
                        <p class="text-gray-600 mb-4">{post.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-500">
                                {post.date}
                            </span>
                            <a
                                href={`/cikkek/${post.slug}`}
                                class="text-blue-500 hover:text-blue-700"
                            >
                                Read more
                            </a>
                        </div>
                    </div>
                </div>
            ))
        }
    </div>
</Layout>
