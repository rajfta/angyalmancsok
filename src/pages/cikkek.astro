---
import { getCollection } from "astro:content";
import BlogCard from "~/components/BlogPage/BlogCard";
import BlogHero from "~/components/BlogPage/BlogHero";
import Layout from "~/layouts/Layout.astro";

const postsEntries = await getCollection("posts");
const posts = postsEntries
	.sort((a, b) => {
		const priorityDiff = (a.data.priority || 0) - (b.data.priority || 0);
		if (priorityDiff !== 0) return priorityDiff;
		return a.data.date.getTime() - b.data.date.getTime();
	})
	.map((entry) => ({
		title: entry.data.title,
		slug: entry.data.slug,
		thumbnail: entry.data.thumbnail ?? undefined,
		description: entry.data.description ?? undefined,
		date: entry.data.date.toLocaleDateString("hu-HU"),
	}));
---

<Layout title="Újdonságok | Angyalmancsok">
	<BlogHero client:load />

	<section class="py-12 md:py-16">
		{posts.length > 0 ? (
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
				{posts.map((post, index) => (
					<BlogCard client:load post={post} index={index} />
				))}
			</div>
		) : (
			<div class="text-center py-20">
				<p class="text-xl text-text-description">
					Jelenleg nincsenek elérhető cikkek. Kérjük, látogasson vissza később!
				</p>
			</div>
		)}
	</section>
</Layout>
