---
import { getCollection } from "astro:content";
import Layout from "~/layouts/Layout.astro";

const postsEntries = await getCollection("posts");
const posts = postsEntries
	.sort((a, b) => {
		const priorityDiff = (a.data.priority || 0) - (b.data.priority || 0);
		if (priorityDiff !== 0) return priorityDiff;
		return a.data.date.getTime() - b.data.date.getTime();
	})
	.map((entry) => ({
		...entry.data,
		id: entry.id,
		date: entry.data.date.toLocaleDateString("hu-HU"),
	}));
---

<Layout title="Cikkek">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 container-padding py-16">
        {posts.map((post) => (
            <div class="bg-bg-highlight shadow-md rounded-lg overflow-hidden">
                {post.thumbnail && (
                    <img
                        src={post.thumbnail}
                        alt={post.title}
                        class="w-full h-48 object-cover"
                    />
                )}
                <div class="p-6">
                    <h2 class="text-xl font-semibold mb-2">{post.title}</h2>
                    <p class="text-gray-600 mb-4">{post.description}</p>
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm text-gray-500">{post.date}</span>
                    </div>
                    {post.gallery && post.gallery.length > 0 && (
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">Galéria</h3>
                            <div class="flex space-x-2 overflow-x-auto">
                                {post.gallery.map((imageUrl: string) => (
                                    <img
                                        src={imageUrl}
                                        alt="Gallery image"
                                        class="w-48 h-48 object-cover rounded"
                                    />
                                ))}
                            </div>
                        </div>
                    )}
                    <div class="mt-4">
                        <a
                            href={`/cikkek/${post.slug}`}
                            class="text-primary-600 hover:text-primary-700 font-medium"
                        >
                            Tovább olvasom →
                        </a>
                    </div>
                </div>
            </div>
        ))}
    </div>
</Layout>
