---
import { getCollection } from "astro:content";
import Hero from "~/components/HomePage/Hero";
import OurDogs from "~/components/HomePage/OurDogs";
import Partners from "~/components/HomePage/Partners";
import Programs from "~/components/HomePage/Programs";
import Testimonials from "~/components/HomePage/Testimonials";
import Layout from "~/layouts/Layout.astro";

// Fetch content from collections
const testimonialsEntries = await getCollection("testimonials");
const partnersEntries = await getCollection("partners");
const programsEntries = await getCollection("programs");
const dogsEntries = await getCollection("dogs");
const membersEntries = await getCollection("members");

// Transform and sort
const testimonials = testimonialsEntries
	.sort((a, b) => (a.data.priority || 0) - (b.data.priority || 0))
	.map((entry) => ({
		id: entry.id,
		quote: entry.data.quote,
		author: entry.data.author,
		dogName: entry.data.dogName,
		handlerName: entry.data.handlerName,
		dogPhoto: entry.data.dogPhoto,
	}));

const partners = partnersEntries
	.sort((a, b) => (a.data.priority || 0) - (b.data.priority || 0))
	.map((entry) => ({
		id: entry.id,
		name: entry.data.name,
		logo: entry.data.logo,
		website: entry.data.website,
	}));

const programs = programsEntries
	.sort((a, b) => (a.data.priority || 0) - (b.data.priority || 0))
	.map((entry) => ({
		id: entry.id,
		title: entry.data.title,
		icon: entry.data.icon,
		description: entry.data.description,
		imageUrl: entry.data.imageUrl,
	}));

const dogs = dogsEntries
	.sort((a, b) => b.data.priority - a.data.priority)
	.map((entry) => ({
		id: entry.id,
		name: entry.data.name,
		thumbnail: entry.data.thumbnail,
		photoWithOwner: entry.data.photoWithOwner,
		nicknames: entry.data.nicknames,
		workplaces: entry.data.workplaces,
		owner: entry.data.owner,
		certificates: entry.data.certificates,
		priority: entry.data.priority,
		body: entry.body,
	}));

const members = membersEntries
	.sort((a, b) => a.data.priority - b.data.priority)
	.map((entry) => ({
		id: entry.id,
		name: entry.data.name,
		picture: entry.data.picture,
		role: entry.data.role,
		dogs: entry.data.dogs,
		titles: entry.data.titles,
		priority: entry.data.priority,
	}));
---

<Layout title="Angyalmancsok | Terápiás kutyák">
    <Hero client:load />
    <Programs client:load programs={programs} />
	<OurDogs client:load dogs={dogs} members={members} />
    <Testimonials client:load testimonials={testimonials} />
    <Partners client:load partners={partners} />
</Layout>
