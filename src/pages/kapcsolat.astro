---
export const prerender = true;

import { getCollection } from "astro:content";
import ContactFormSection from "~/components/ContactPage/ContactFormSection";
import ContactHero from "~/components/ContactPage/ContactHero";
import ProcessSteps from "~/components/ContactPage/ProcessSteps";
import RequirementsSection from "~/components/ContactPage/RequirementsSection";
import VolunteerSection from "~/components/ContactPage/VolunteerSection";
import Layout from "~/layouts/Layout.astro";

// Fetch contact content collections
const contactEntries = await getCollection("contact");

// Fetch site settings
const settingsEntries = await getCollection("settings");
const settings = settingsEntries[0]?.data;

// Sort by priority
const contactSections = contactEntries.sort(
	(a, b) => (a.data.priority || 0) - (b.data.priority || 0),
);

// Get individual sections by type
const hero = contactSections.find(
	(section) => section.data.sectionType === "hero",
);
const volunteer = contactSections.find(
	(section) => section.data.sectionType === "volunteer",
);
const requirements = contactSections.find(
	(section) => section.data.sectionType === "requirements",
);
const process = contactSections.find(
	(section) => section.data.sectionType === "process",
);
---

<Layout title="Angyalmancsok | Kapcsolat">
    <div class="relative">
        <!-- Hero Section -->
        <ContactHero
            client:load
            title={hero?.data.title}
            description={hero?.data.description}
        />

        <!-- Timeline Container -->
        <div class="relative container-padding py-16 max-w-7xl mx-auto">
            <!-- Timeline Center Line -->
            <div class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary-200 via-accent-300 to-primary-200 -translate-x-1/2" style="background-image: repeating-linear-gradient(to bottom, #d5d8dd 0, #d5d8dd 10px, transparent 10px, transparent 20px);"></div>

            <!-- Section 1: Volunteering (Left) -->
            <VolunteerSection
                client:load
                title={volunteer?.data.title}
                description={volunteer?.data.description}
                tasks={volunteer?.data.tasks}
                image={volunteer?.data.image}
            />

            <!-- Section 2: Requirements (Right) -->
            <RequirementsSection
                client:load
                title={requirements?.data.title}
                description={requirements?.data.description}
                requirements={requirements?.data.requirements}
                image={requirements?.data.image}
            />

            <!-- Section 3: Process Steps (Left) -->
            <ProcessSteps
                client:load
                title={process?.data.title}
                description={process?.data.description}
                steps={process?.data.steps}
                content={process?.body}
            />
        </div>

        <!-- Section 4: Contact Form (Center/Full) -->
        <ContactFormSection
            client:load
            phone={settings?.phone}
            phoneRaw={settings?.phoneRaw}
            instagramUrl={settings?.instagramUrl}
            facebookUrl={settings?.facebookUrl}
        />
    </div>
</Layout>
