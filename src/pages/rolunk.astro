---
import { getCollection } from "astro:content";
import AboutHero from "~/components/AboutPage/AboutHero";
import MissionSection from "~/components/AboutPage/MissionSection";
import StorySection from "~/components/AboutPage/StorySection";
import TeamSection from "~/components/AboutPage/TeamSection";
import VisionSection from "~/components/AboutPage/VisionSection";
import Layout from "~/layouts/Layout.astro";

// Fetch content collections
const aboutEntries = await getCollection("about");
const membersEntries = await getCollection("members");
const dogsEntries = await getCollection("dogs");

// Sort about sections by priority
const aboutSections = aboutEntries.sort(
	(a, b) => a.data.priority - b.data.priority,
);

// Get individual sections
const vision = aboutSections.find((section) => section.id === "vision");
const story = aboutSections.find((section) => section.id === "story");
const mission = aboutSections.find((section) => section.id === "mission");

// Sort members by priority
const members = membersEntries
	.sort((a, b) => a.data.priority - b.data.priority)
	.map((entry) => ({
		id: entry.id,
		name: entry.data.name,
		picture: entry.data.picture,
		role: entry.data.role,
		dogs: entry.data.dogs,
		titles: entry.data.titles,
		priority: entry.data.priority,
		body: entry.body,
	}));

// Get dogs for the team section
const dogs = dogsEntries.map((entry) => ({
	id: entry.id,
	name: entry.data.name,
	thumbnail: entry.data.thumbnail,
}));
---

<Layout title="Angyalmancsok | RÃ³lunk">
	<AboutHero client:load />

	{vision && (
		<VisionSection
			client:load
			title={vision.data.title}
			content={vision.data.content}
			image={vision.data.image}
		/>
	)}

	{story && (
		<StorySection
			client:load
			title={story.data.title}
			content={story.data.content}
			image={story.data.image}
		/>
	)}

	{mission && (
		<MissionSection
			client:load
			title={mission.data.title}
			content={mission.data.content}
			image={mission.data.image}
		/>
	)}

	<TeamSection client:load members={members} dogs={dogs} />
</Layout>
